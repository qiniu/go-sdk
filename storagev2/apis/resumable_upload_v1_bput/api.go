// THIS FILE IS GENERATED BY api-generator, DO NOT EDIT DIRECTLY!

// 上传指定块的一片数据，具体数据量可根据现场环境调整，同一块的每片数据必须串行上传
package resumable_upload_v1_bput

import (
	"encoding/json"
	io "github.com/qiniu/go-sdk/v7/internal/io"
	errors "github.com/qiniu/go-sdk/v7/storagev2/errors"
	uptoken "github.com/qiniu/go-sdk/v7/storagev2/uptoken"
)

// 调用 API 所用的请求
type Request struct {
	Ctx         string            // 前一次上传返回的块级上传控制信息
	ChunkOffset int64             // 当前片在整个块中的起始偏移
	UpToken     uptoken.Provider  // 上传凭证，如果为空，则使用 HTTPClientOptions 中的 UpToken
	Body        io.ReadSeekCloser // 请求体
}

// 获取 API 所用的响应
type Response struct {
	Ctx       string // 本次上传成功后的块级上传控制信息，用于后续上传片（bput）及创建文件（mkfile）
	Checksum  string // 上传块 SHA1 值，使用 URL 安全的 Base64 编码
	Crc32     int64  // 上传块 CRC32 值，客户可通过此字段对上传块的完整性进行校验
	Offset    int64  // 下一个上传块在切割块中的偏移
	Host      string // 后续上传接收地址
	ExpiredAt int64  // `ctx` 过期时间
}

// 返回下一片数据的上传信息
type ChunkInfo = Response
type jsonResponse struct {
	Ctx       string `json:"ctx"`        // 本次上传成功后的块级上传控制信息，用于后续上传片（bput）及创建文件（mkfile）
	Checksum  string `json:"checksum"`   // 上传块 SHA1 值，使用 URL 安全的 Base64 编码
	Crc32     int64  `json:"crc32"`      // 上传块 CRC32 值，客户可通过此字段对上传块的完整性进行校验
	Offset    int64  `json:"offset"`     // 下一个上传块在切割块中的偏移
	Host      string `json:"host"`       // 后续上传接收地址
	ExpiredAt int64  `json:"expired_at"` // `ctx` 过期时间
}

func (j *Response) MarshalJSON() ([]byte, error) {
	if err := j.validate(); err != nil {
		return nil, err
	}
	return json.Marshal(&jsonResponse{Ctx: j.Ctx, Checksum: j.Checksum, Crc32: j.Crc32, Offset: j.Offset, Host: j.Host, ExpiredAt: j.ExpiredAt})
}
func (j *Response) UnmarshalJSON(data []byte) error {
	var nj jsonResponse
	if err := json.Unmarshal(data, &nj); err != nil {
		return err
	}
	j.Ctx = nj.Ctx
	j.Checksum = nj.Checksum
	j.Crc32 = nj.Crc32
	j.Offset = nj.Offset
	j.Host = nj.Host
	j.ExpiredAt = nj.ExpiredAt
	return nil
}
func (j *Response) validate() error {
	if j.Ctx == "" {
		return errors.MissingRequiredFieldError{Name: "Ctx"}
	}
	if j.Checksum == "" {
		return errors.MissingRequiredFieldError{Name: "Checksum"}
	}
	if j.Host == "" {
		return errors.MissingRequiredFieldError{Name: "Host"}
	}
	if j.ExpiredAt == 0 {
		return errors.MissingRequiredFieldError{Name: "ExpiredAt"}
	}
	return nil
}
